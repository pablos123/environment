#!/usr/bin/env bash
set -Eeuo pipefail

source "${HOME}/environment/lib/helpers.bash"

# --------------------------------------------------
# Lock screen with blurred screenshot
# --------------------------------------------------

TMP_FILE="$(mktemp --suffix=.png)"
TMP_FILE_BLUR="$(mktemp --suffix=.png)"
readonly TMP_FILE TMP_FILE_BLUR

cleanup() {
    rm -f "${TMP_FILE}" "${TMP_FILE_BLUR}"
}

command -v scrot >/dev/null || die "scrot not found"
command -v convert >/dev/null || die "convert (imagemagick) not found"
command -v i3lock >/dev/null || die "i3lock not found"

scrot -o "${TMP_FILE}"
convert -blur 0x20 "${TMP_FILE}" "${TMP_FILE_BLUR}"

i3lock --no-unlock-indicator --nofork --ignore-empty-password -i "${TMP_FILE_BLUR}"

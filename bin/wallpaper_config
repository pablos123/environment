#!/usr/bin/env bash
set -Eeuo pipefail

# --------------------------------------------------
# Wallpaper configuration
# Sets random wallpaper from theme directory
# --------------------------------------------------

readonly WALLPAPER_INTERVAL=600
readonly THEME="${2:-}"

function set_wallpaper() {
    local wallpapers_array items_count random_index wallpaper wallpapers_dir

    wallpapers_dir="${HOME}/images/wallpapers/${THEME}/"
    [[ ! -d "${wallpapers_dir}" ]] &&
        wallpapers_dir="${HOME}/images/wallpapers/"

    mapfile -t wallpapers_array < <(find "${wallpapers_dir}" -maxdepth 1 -type f)

    items_count="${#wallpapers_array[@]}"
    [[ "${items_count}" -eq 0 ]] &&
        return

    random_index=$((RANDOM % items_count))
    wallpaper="${wallpapers_array[${random_index}]}"

    hsetroot -cover "${wallpaper}" &>/dev/null
}

set_wallpaper

# --------------------------------------------------
# Daemon mode
# --------------------------------------------------

if [[ "${1:-}" == "-d" ]]; then
    while true; do
        sleep "${WALLPAPER_INTERVAL}"
        set_wallpaper
    done
fi

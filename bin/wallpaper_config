#!/usr/bin/env bash

theme=$2

function set_wallpaper() {
    local wallpapers_array items_count random_index wallpaper wallpapers_dir

    wallpapers_dir="${HOME}/images/wallpapers/${theme}/"
    [[ ! -d "${wallpapers_dir}" ]] &&
        wallpapers_dir="${HOME}/images/wallpapers/"

    mapfile -t wallpapers_array < <(find "${wallpapers_dir}" -maxdepth 1 -type f)

    items_count="${#wallpapers_array[@]}"
    [[ "${items_count}" -eq 0 ]] &&
        return

    random_index=$((RANDOM % items_count))
    wallpaper="${wallpapers_array[${random_index}]}"

    hsetroot -cover "${wallpaper}" &>>/dev/null
}

set_wallpaper

if [[ "${1}" == "-d" ]]; then
    while true; do
        sleep 600
        set_wallpaper
    done
fi

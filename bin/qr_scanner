#!/usr/bin/env bash
set -Eeuo pipefail

source "${HOME}/environment/lib/helpers.bash"

# --------------------------------------------------
# QR scanner - screenshot and decode to clipboard
# --------------------------------------------------

TMP_FILE="$(mktemp --suffix=.png)"
readonly TMP_FILE

cleanup() {
    rm -f "${TMP_FILE}"
}

command -v flameshot >/dev/null || die "flameshot not found"
command -v zbarimg >/dev/null || die "zbarimg not found"

flameshot gui -p "${TMP_FILE}" &>/dev/null || exit 0

qr_content="$(zbarimg --raw --quiet "${TMP_FILE}" || true)"

echo "${qr_content}" | xclip
[[ -n "${qr_content}" ]] &&
    notify-send "${qr_content}"

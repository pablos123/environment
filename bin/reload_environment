#!/usr/bin/env bash

files_to_remove=(
    "${HOME}/.dotfiles_stow"
    "${HOME}/.bashrc"
    "${HOME}/.profile"
    "${HOME}/.xinitrc"
    "${HOME}/.xprofile"
    "${HOME}/.Xresources"
    "${HOME}/.gtkrc-2.0"
    "${HOME}/.config/gtk-3.0"
)

rm -rf -- "${files_to_remove[@]}"

git -C "${HOME}/environment/" pull &>>/dev/null

# Copy the base content
cp -r -- "${HOME}/environment/dotfiles" "${HOME}/.dotfiles_stow"

# Stow the new files
(
    cd "${HOME}/.dotfiles_stow" || exit 1
    stow --target="${HOME}" --restow -- */
)

rm -f -- "${HOME}/rofi-3.runcache" "${HOME}/.cache/dmenu_run" "${HOME}/dmenu_cache"


{
    fc-cache -rf

    killall dunst
    while pgrep -u "${UID}" -x dunst >/dev/null; do sleep 0.3; done

    killall flameshot
    while pgrep -u "${UID}" -x flameshot >/dev/null; do sleep 0.3; done

    killall picom
    while pgrep -u "${UID}" -x picom >/dev/null; do sleep 0.3; done
    picom --daemon &

    polybar-msg cmd quit
    while pgrep -u "${UID}" -x polybar >/dev/null; do sleep 0.3; done

    i3-msg restart

} &>>/dev/null

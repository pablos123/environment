#!/usr/bin/env bash

function get_headers() {
    local header_name header_names result
    header_names=(
        "Version"
        "Code Name"
        "Release Date"
        "End of Life"
        "End of LTS"
        "End of ELTS"
        "Status"
    )
    

    result=""
    for header_name in "${header_names[@]}"; do
        result+="\e[1;35m${header_name}\e[0m,"
    done

    echo -e "${result}"
}

function debian_versions() {
    local curl_response_md old_ifs releases_url release_table_md

    releases_url='https://www.debian.org/releases/'
    

    old_ifs="${IFS}" && IFS=$'\n'
    

    curl_response_md="$(pandoc -f html -t markdown <(curl "${releases_url}" 2>/dev/null))"
    

    release_table_md="$(
        sed -En '
            /^\s+Version\s+Code Name\s+Release Date\s+End of Life\s+/,/^$/ {p; /^$/q}; # Print lines and quit after the first empty line.
        ' <<< "${curl_response_md}")"
    

    sanitized_table="$(
      sed -E '
            s/^\s+//;
            /^$/d;
            s/.*Version.*//;
            s/.*-----.*//;
            s/\(.*\/\)//;
            s/\s{2,}/\t/g;
        ' <<< "${release_table_md}"
    )"
    

    column --table --separator $'\t' --table-columns "$(get_headers)" <<< "${sanitized_table}"

    echo -e "\n${releases_url}\n"

    IFS="${old_ifs}"
}

debian_versions "$@"


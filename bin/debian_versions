#!/usr/bin/env bash

function debian_versions() {
    local curl_response_md old_ifs response_lines show_old releases_url l

    releases_url=https://www.debian.org/releases/
    readonly releases_url

    old_ifs="${IFS}" && IFS=$'\n'
    readonly old_ifs

    curl_response_md="$(pandoc -f html -t markdown <(curl "${releases_url}" 2>/dev/null))"
    readonly curl_response_md

    mapfile -t response_lines < <(echo "${curl_response_md}" | sed -En '/^\s+Version\s+Code Name\s+Release Date\s+End of Life/,/^$/p' | tr -d '\\')
    readonly response_lines

    show_old=false
    [[ $1 == '-o' ]] &&
        show_old=true

    echo -e '\n\e[1;4;32mINDEX OF RELEASES\e[0m\n'

    for l in "${response_lines[@]}"; do
        echo "${l}" | sed -E 's/^\s+//'
        if [[ -z "${l}" ]]; then
            ! "${show_old}" &&
                break

            show_old=false
            echo -e '\e[1;4;32mHISTORIC RELEASES\e[0m\n'
        fi
    done

    IFS="${old_ifs}"

    echo -e "\n${releases_url}\n"
}

debian_versions "$@"

